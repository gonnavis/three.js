<html>

<head>
  <title></title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
  <style>
    body {
      margin: 0;
    }

    canvas {
      width: 100%;
      height: 100%
    }
  </style>
</head>

<body>
  <script>
    window.THREE = true
  </script>
  <script type="module">
    // https://github.com/mrdoob/three.js/issues/21379

    import * as THREE from '../src/Three.js';
    import {
      OrbitControls
    } from '../examples/jsm/controls/OrbitControls.js'


    const renderer = new THREE.WebGLRenderer({});
    const scene = new THREE.Scene();
    const camera = new THREE.PerspectiveCamera(75, 2, 0.01, 1000);
    const controls = new OrbitControls(camera, renderer.domElement);
    window.addEventListener('resize', () => {
      const {
        clientWidth,
        clientHeight
      } = renderer.domElement;
      renderer.setSize(clientWidth, clientHeight, false);
      renderer.setPixelRatio(window.devicePixelRatio);
      camera.aspect = clientWidth / clientHeight;
      camera.updateProjectionMatrix();
    });
    document.body.prepend(renderer.domElement);
    window.dispatchEvent(new Event('resize'));

    //// Setup

    camera.position.set(0, 0, 5);

    //// Lightings

    const light0 = new THREE.DirectionalLight();
    scene.add(light0);

    const light1 = new THREE.AmbientLight();
    scene.add(light1);

    //// Make an instanced mesh

    const mesh0 = new THREE.InstancedMesh(
      new THREE.SphereBufferGeometry(0.5, 32, 32),
      new THREE.MeshStandardMaterial({
        color: 'white',
        metalness: 0.5,
        roughness: 0.5
      }),
      1
    );
		mesh0.name='my_instancedMesh'
    mesh0.setMatrixAt(0, new THREE.Matrix4().makeTranslation(0, 0, 0));
    // mesh0.setMatrixAt(1, new THREE.Matrix4().makeTranslation(1, 1, 0));
    mesh0.instanceMatrix.needsUpdate = true;

    //// Make a regular mesh

    const mesh1 = new THREE.Mesh(
      new THREE.BoxBufferGeometry(1, 1, 1),
      new THREE.MeshStandardMaterial({
        color: 'red',
        metalness: 0.5,
        roughness: 0.5
      })
    );
		mesh1.name='my_regular_mesh'
    mesh1.position.set(0, 1, 0);

    //// Now, add meshes (instanced mesh + regular mesh) to the scene

    scene.add(mesh0, mesh1);
		scene.overrideMaterial = new THREE.MeshNormalMaterial()

    //// Set render loop

    renderer.setAnimationLoop(() => {
      renderer.render(scene, camera)
      controls.update();
    });


  </script>
</body>

</html>
